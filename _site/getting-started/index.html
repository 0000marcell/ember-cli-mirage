<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Getting started &middot; Ember CLI Mirage
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/style.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <h1 class="header-title">
        <a href="/">
          Ember CLI Mirage
        </a>
      </h1>
      <p class="lead">A client-side mock server to develop, test and prototype your Ember CLI app</p>
    </div>

    <ul class="sidebar-nav">
      <li>
        <a class="sidebar-nav-item" href="/">
          Home
        </a>
      </li>
      <li>
        <a class="sidebar-nav-item active" href="/getting-started">
          Getting started
        </a>
      </li>
      <li>
        <a class="sidebar-nav-item" href="/api">
          API
        </a>
      </li>
      <li class='sidebar-bottom-items'>
        <a href="https://github.com/samselikoff/ember-cli-mirage">View on GitHub</a>
        &middot;
        <span>v0.0.27</span>
      </li>
    </ul>
  </div>
</div>


    <div class="content container">
      <div class="page">
  <h1 class="page-title">Getting started</h1>
  <p>A Mirage server is split into two pieces:</p>

<ul>
<li><strong>routes</strong>, which define the URLs your server responds to, and</li>
<li>a <strong>database</strong>, your server&#39;s clientside cache</li>
</ul>

<p>Let&#39;s add some data to the database. The generator should have created the file <code>/app/mirage/fixtures/contacts.js</code>, which exports some data:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app/mirage/fixtures/contacts.js</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Zelda&#39;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Link&#39;</span>
  <span class="p">},</span>
<span class="p">];</span>
</code></pre></div>
<p>Given this file, whenever your Mirage server starts up, this data will be added to its database under the <code>contacts</code> key (since that&#39;s the name of the file). Add additional data by adding more files under the <code>/fixtures</code> folder. All fixture files should be plural, and export arrays of POJOs.</p>

<h3>Defining your routes</h3>

<p>Now, to return this data from an endpoint, let&#39;s define our first route. We&#39;ll use the <strong>get</strong> helper method to easily interact with our server&#39;s db (which now has these contacts in it).</p>

<p>The generator should have created the file <code>app/mirage/config.js</code>, which exports a function. Add a route for <code>/api/contacts</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app/mirage/config.js</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;contacts&#39;</span><span class="p">);</span>

<span class="p">};</span>
</code></pre></div>
<p>This is the simplest example of a GET route. Here, we&#39;re telling Mirage that whenever our Ember app makes a GET request to <code>/api/contacts</code>, respond with all the <code>contacts</code> in our db. So the first argument of <code>get</code> is the <em>path</em> of the route we&#39;re defining a handler for, and the second is the <em>objects in the db</em> we want to respond with.</p>

<p>As long as all your Mirage routes read from and write to the db, your user interactions during development will persist. This lets users interact with your app as if it were wired up to a real server.</p>

<p>We can also respond with multiple objects from the db, let&#39;s say if our app expects additional data to be sideloaded at this URL:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/contacts&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;contacts&#39;</span><span class="p">,</span> <span class="s1">&#39;addresses&#39;</span><span class="p">]);</span>
</code></pre></div>
<p>This will return all the data you added to the <code>contacts</code> and <code>addresses</code> keys of your db.</p>

<p>Handling POST, PUT and DELETE requests is just as simple. For example, this route lets you create new <code>users</code> by POSTing to <code>/api/users</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/users&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Passing just a string or array as the second argument to get, post, put or del
(as shown above) is an example of a <strong>shorthand</strong>. There are <a href="../../wiki/HTTP-Verb-methods">several available</a>
to make writing your routes as concise as possible, but sometimes you&#39;ll need
to do some custom work. In that case, you can pass a function in as the second
argument, and interact directly with the db and Pretender request object:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">db</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">requestBody</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">newContact</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">contacts</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">contact</span><span class="o">:</span> <span class="nx">newContact</span>
  <span class="p">};</span>
<span class="p">});</span>
</code></pre></div>
<p>Find the complete documentation for the db as well as the rest of the
available shorthands for <code>get</code>, <code>post</code>, <code>put</code> and <code>del</code> <a href="../../wiki">in the wiki</a>.</p>

<h3>Acceptance testing</h3>

<p>During testing, the db always starts off empty; however, all the routes you&#39;ve defined will still be available (since these are what your app expects, and mostly shouldn&#39;t change within your tests). The db is emptied because tests should be atomic, and should not rely on state defined elsewhere. This means the data you&#39;ve added under <code>/mirage/fixtures</code> will not be available in your tests.</p>

<blockquote>
<p>Note: For now, since factory relationships haven&#39;t landed yet, if you prefer to just use fixtures in your tests, delete the <code>/mirage/factories</code> directory. The fixtures under <code>/mirage/fixtures</code> will then load during testing, and you can use those as a starting point, and modify your db data via <code>server.db</code> in your tests. Once factories are fleshed out, this will most likely be discouraged.</p>
</blockquote>

<p>Instead, to get data into your tests, you&#39;ll define factories. That way, each test can create the data it needs (i.e. it can set up the &quot;server state&quot; it expects), and then assert against that data.</p>

<p>Let&#39;s define a <code>contact</code> factory. The generator should have created the file <code>/app/mirage/factories/contact.js</code> - the name of the file is how you reference the factory:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app/mirage/factories/contact.js</span>
<span class="kr">import</span> <span class="nx">Mirage</span> <span class="nx">from</span> <span class="s1">&#39;ember-cli-mirage&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Mirage</span><span class="p">.</span><span class="nx">Factory</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Pete&#39;</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>

  <span class="nx">email</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="err">`</span><span class="nx">person$</span><span class="p">{</span><span class="nx">i</span><span class="p">}</span><span class="err">@</span><span class="nx">test</span><span class="p">.</span><span class="nx">com</span><span class="err">`</span><span class="p">,</span>

  <span class="nx">admin</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>The attributes of your factory can either be plain numbers or strings, or functions. A function gets the sequence of the factory <em>i</em> as its only parameter. Within the function you can also reference the plain attributes (numbers and strings) of the generated object via <code>this.attr</code>.</p>

<p>Let&#39;s use this factory in an acceptance test. We want to assert against our index route, assuming there are three contacts in our server when our Ember app boots up and renders.</p>

<p>In your tests you&#39;ll have access to the <code>server</code> variable, which has two helper methods attached to it: <code>create</code> and <code>createList</code>. Let&#39;s use <code>createList</code> to set up our server&#39;s state for this test:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// tests/acceptance/index-test.js</span>

<span class="nx">test</span><span class="p">(</span><span class="s2">&quot;I can view the contacts&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// set up our server&#39;s state</span>
  <span class="kd">var</span> <span class="nx">contacts</span> <span class="o">=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">createList</span><span class="p">(</span><span class="s1">&#39;contact&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

  <span class="nx">visit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>

  <span class="nx">andThen</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">equal</span><span class="p">(</span><span class="nx">currentRouteName</span><span class="p">(),</span> <span class="s1">&#39;index&#39;</span><span class="p">);</span>
    <span class="nx">equal</span><span class="p">(</span> <span class="nx">find</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
    <span class="nx">equal</span><span class="p">(</span> <span class="nx">find</span><span class="p">(</span><span class="s1">&#39;li:first&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(),</span> <span class="nx">contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span> <span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>You can also put calls to <code>create</code> and <code>createList</code> within your test module&#39;s <code>setup</code> block if you want to share them across <code>test</code>s. You can even test how your UI reacts when your server <a href="https://github.com/samselikoff/ember-cli-mirage/wiki/Acceptance-testing#timing">responds slowly</a> or <a href="https://github.com/samselikoff/ember-cli-mirage/wiki/Acceptance-testing#verb">responds with an error</a>.</p>

<p>View the <a href="../../wiki/Acceptance-testing">acceptance test wiki page</a> for more examples and the full API.</p>

<hr>

<p>That should be enough to get started! The dummy app in this example has a fully working <a href="tests/dummy/app/mirage/config.js">config</a>, <a href="tests/factories/contact.js">factory</a>, and some <a href="tests/acceptance">acceptance tests</a> you can look at. Be sure to <a href="../../wiki">check out the wiki</a> for the full API.</p>

</div>

    </div>

  </body>
</html>
